{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "type": "object",
  "properties": {
    "image_name": {
      "type": "string",
      "description": "Either the name of an existing image, or the name to give to the new image",
      "pattern": "^[-a-zA-Z0-9]+$"
    },
    "image_description": {
      "type": "string",
      "description": "The description to use for that image. Required only if the image doesn't already exist."
    },
    "image_hardware_type": {
      "type": "string",
      "description": "What hardware type the image should have. Required only if the image doesn't already exist.",
      "enum": [
        "cpu",
        "gpu"
      ]
    },
    "image_language": {
      "type": "string",
      "description": "The programming language that the image supports. Required only if the image doesn't already exist.",
      "enum": [
        "python",
        "r"
      ]
    },
    "version_name": {
      "type": "string",
      "description": "the name of the particular version of the image being created",
      "pattern": "^[-a-zA-Z0-9]+$"
    },
    "version_description": {
      "type": "string",
      "description": "Details on the version being created"
    },
    "version_build_data": {
      "type": "object",
      "description": "details on how this version of the image is being built",
      "oneOf": [
        {
          "description": "Details for when building an image using the Saturn Cloud build pipeline",
          "properties": {
            "base_image_uri": {
              "type": "string",
              "description": "The base image to build from"
            },
            "pip_requirements": {
              "type": "array",
              "description": "Packages to install from pip",
              "items": {
                "type": "string"
              }
            },
            "conda_environment": {
              "type": "string",
              "description": "A conda environment yaml"
            },
            "apt_packages": {
              "type": "array",
              "description": "Packages to install from apt-get install",
              "items": {
                "type": "string"
              }
            },
            "post_build": {
              "type": "string",
              "description": "A shell script to execute as the last step"
            }
          },
          "required": [
            "base_image_uri"
          ]
        },
        {
          "description": "Details for when building an image from an external location",
          "properties": {
            "external_image_uri": {
              "description": "location of the external image to use",
              "type": "string"
            }
          },
          "required": [
            "external_image_uri"
          ]
        }
      ]
    }
  },
  "required": [
    "image_name",
    "version_name",
    "version_description",
    "version_build_data"
  ]
}